
> 프로그램이 CPU에 의해 실행됨 → 프로세스가 생성되고 메모리에 **'프로세스 주소 공간'**이 할당됨

프로세스 주소 공간에는 코드, 데이터, 스택으로 이루어져 있다.

-   **코드 Segment** : 프로그램 소스 코드 저장
-   **데이터 Segment** : 전역 변수 저장
-   **스택 Segment** : 함수, 지역 변수 저장

**왜 이렇게 구역을 나눈건가요?**

최대한 데이터를 공유하여 메모리 사용량을 줄여야 합니다.

Code는 같은 프로그램 자체에서는 모두 같은 내용이기 때문에 따로 관리하여 공유함

Stack과 데이터를 나눈 이유는, 스택 구조의 특성과 전역 변수의 활용성을 위한 것!

[![](https://camo.githubusercontent.com/c98b302e6bd4eaf6f2c81cb1ebb1dda95448b6154c9abefca915207fc635478e/68747470733a2f2f74312e6461756d63646e2e6e65742f6366696c652f746973746f72792f323137343031333835384631424544373041)](https://camo.githubusercontent.com/c98b302e6bd4eaf6f2c81cb1ebb1dda95448b6154c9abefca915207fc635478e/68747470733a2f2f74312e6461756d63646e2e6e65742f6366696c652f746973746f72792f323137343031333835384631424544373041)

```
프로그램의 함수와 지역 변수는, LIFO(가장 나중에 들어간게 먼저 나옴)특성을 가진 스택에서 실행된다. 
따라서 이 함수들 안에서 공통으로 사용하는 '전역 변수'는 따로 지정해주면 메모리를 아낄 수 있다.
```


Q. 프로세스의 주소 공간이 생기는 이유?

각 프로그램들은 [[SSD]] 에 저장되어 있다.
프로그램이 실행될 때 이것을 좀 더 빠른 [[Ram]]으로 옮겨와 사용하는데, 이것을 메인 메모리라고 한다.
메인 메모리의 한 부분에 프로그램을 적재하고 실행하는데, 이 때 실행되는 하나의 프로그램을 프로세스라고 한다.

이 때 적재된 메인 메모리의 한 부분을 **메모리 주소 공간**이라고 한다. 메인 메모리의 공간은 결국에는 한정되어있기 때문에, 프로세스는 다양한 방법으로 메모리를 절약하려고 시도한다. 결국 여기서 최적화를 하기 위해 해당 부분을 OS가 효율적으로 관리하기 위해 몇 가지 특징 및 사용 방식에 따라 공간을 나누었다. 공간은 다음과 같다.

**텍스트(코드), 데이터, 힙, 스택**

이것을 순서로 나타내면 다음과 같다.

low
텍스트
데이터
힙

스택
high

하나 씩 설명하면

**텍스트(코드) 영역**은 프로그램이 실행될 수 있도록 CPU가 해석 가능한 기계어 코드가 저장되어 있는 공간이다. 해당 영역은 프로그램이 수정되면 안되기 때문에 **ReadOnly** 상태로 저장되어 있다.
여기서 코드라고 해서 high language 코드, 즉 C 혹은 C++언어로 된 코드가 아닌 0과 1로 이루어진 "기계어"코드를 뜻한다.
**high language 언어**는 사용자가 쉽게 다룰 수 있는 코드로 C, Python, Java등을 뜻하고, 
**low language언어**는 사용자보다 기계쪽에 더 가까운 코드로 어셈블리언어를 뜻한다.

- **프로그램의 실행 과정**
전처리 -> 컴파일 -> 어셈블리 -> 링킹 

[[자바스크립트 동작원리]]

그럼 인터프리터 언어와 범주가 다르기에 비교하기 어렵다.


high language 언어를 컴파일하면 .o파일로 object파일이 되는데, 이것을 열어보면 어셈블리어로 변환된 것을 확인할 수 있다.

어셈블리어는 기계어와 1대1 매핑이 되는 언어이다. 따라서 기계어 하나와 대응되는 어셈블리어는 유일하다는 특징이 있다.
high --------------------------------------low
C, Python, Java -> assembly -> machine code


데이터 영역
데이터 영역은 전역 변수나 static 변수 등 프로그램이 사용할 수 있는 데이터를 저장하는 영역이다. 해당 영역에 쓰이는 데이터는 프로그램이 시작함과 동시에 할당되며, **종료되면 소멸한다는 특징**이 있다.
data영역에서 또한 두 가지 영역으로 나뉘게 되는데, **data영역**과 **bss영역**이 있다. data영역은 전역변수 혹은 static 변수가 선언이 되고 **초기화** 되었을 때 저장되는 영역이고, bss영역은 해당 변수들이 선언이 되었지만 초기화되지 않았을 때 저장되는 영역이다. 마지막으로 어떤 프로그램에 전역/static 변수를 참조하는 코드가 존재한다면, 이 프로그램은 컴파일 된 후에 data 영역을 참조하게 된다.

힙 영역
해당 영역은 런타임의 크기가 결정되는 영역이다. 또한 사용자에 의해 공간이 동적으로 할당 및 해제되는데, 이것을 dynamic allocation, dynamic deallocation이라 부른다. 주로 클래스 등 참조형 데이터가 해당 영역에 할당되며 메모리의 낮은 주소에서 높은 주소의 방향으로 할당된다.

스택 영역
함수의 호출과 관계되는 지역 변수와 매개변수가 저장되는 영역이다. 스택 영역의 값은 함수의 호출과 함께 할당되며 그것을 스택 프레임이라 부른다. **즉 함수가 호출될 때 해당 함수가 사용될 공간을 미리 알아서 해당 공간만큼 먼저 할당해준다는 얘기이다.** 
-> [[프롤로그 에필로그]]

또한 함수를 진행한 이후 반환값을 주며 또는 주지 않으며 소멸하면서 스택 프레임이 정리된다.
스택 영역은 메모리의 높은 주소에서 낮은 주소의 방향으로 할당되며, 힙 영역과 반대이다. 또한 재귀함수가 너무 깊게 호출되거나 함수가 지역 변수를 너무 많이 가지고 있어 stack영역을 초과하면 **stack overflow에러**가 발생한다.
참고로 stack overflow는 정말 옛날부터 해커들의 주요 공격 대상인 취약점이었다.

Q. 프로세스 주소공간의 구역을 나눈 이유는?
메인 메모리인 RAM은 공간이 한정되어 있기 때문에 최대한 데이터를 공유하여 메모리 사용량을 줄이고 최적화 하기 위해서이다.
- 특징
이와 관련해서 하나의 프로그램을 여러 개 띄울 때 code영역은 같은 내용이기 때문에 공유할 수 있다.


Q. 스택과 데이터 영역을 나눈 이유는 스택 구조의 특성과 전역 변수를 이용하기 위해서이다.

Q. **data영역과 bss영역을 구분하는 이유는?**
초기화되지 않은 변수는 프로그램이 실행할 때 영역만 잡아주면 되고 그 값을 프로그램에 저장하고 있을 필요는 없다. 하지만 초기화되는 변수는 그 값도 프로그램에 저장하고 있어야 하기 때문이다. 따라서 bss영역 변수들이 많아져도 프로그램의 실행코드 사이즈를 늘리지는 않는다.

Q. 스택과 힙의 차이와 나눈 이유는?
스택은 매우 빠른 접근과 할당이 가능하며 메모리에 낭비되는 공간이 없이 사용가능하다는 장점이 있다.
하지만 용량이 무척 적다
힙은 사용자가 따로 할당, 관리를 해서 사용해야 하는 공간으로 스택보다는 느리게 할당된다. 용량은 크지만 단편화의 위험성을 가지고 있다.

Q. **단편화란**?
단편화는 예시로 8mb를 할당하고 있던 공간을 할당해제하고 그 자리에 6mb를 할당했을 때 2mb가 free상태로 남게 된다. 이때 2mb이상의 공간만 할당한다고 가정하게 된다면 해당 자리는 끝까지 사용할 수 없게 된다. 이것이 단편화이다. **(fragmentation)
외부/내부 단편화가 있다.** 

크기를 먼저 설정해주는 스택에 비해 유연하지만 제대로 할당 해제하지 않으면 **메모리 누수**가 일어나서 메모리의 손해를 볼 수 있다.

Q. 모든 영역을 stack에 구현하면 되지 않는 이유는
stack의 특성에 있는데 stack의 특성상 데이터에 접근할 수 있는 부분은 top밖에 없기 때문에 중간에 접근하려고 하면 불가능한 경우가 많다.
따라서 heap에 할당을 하게 되면 포인터로 해당 데이터에 접근이 가능하게 된다.

따라서 나누는 목적은
프로그램 상에서 얼마나 메모리가 필요할지 모르고, 미리 모두 할당해놓은 것은 쓰이지 않을 **메모리까지 할당되어있는 비효율적인 상태에 놓일 수 있으므로 스택 힙으로 나누어 목적에 맞게 할당을 하는 것이다.**



출처 : 전체 구조https://gona.tistory.com/4
전체 구조2 https://velog.io/@klm03025/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%EC%A3%BC%EC%86%8C-%EA%B3%B5%EA%B0%84

스택 힙 차이 https://luv-n-interest.tistory.com/1046
