### 1. custom hook 작성시 유의사함 

```tsx
const onClickHandler = async (

e: React.MouseEvent<HTMLDivElement, MouseEvent>

) => {

e.preventDefault();

useAxios();

};
```

hooks를 최상위 레벨에서 호출해야한다 

-> 공식문서
### Only Call Hooks from React Functions

**Don’t call Hooks from regular JavaScript functions.** Instead, you can:

-   ✅ Call Hooks from React function components.
-   ✅ Call Hooks from custom Hooks (we’ll learn about them [on the next page](https://reactjs.org/docs/hooks-custom.html)).

By following this rule, you ensure that all stateful logic in a component is clearly visible from its source code.

### 교차 출처 리소스 공유(Cross-Origin Resource Sharing, CORS)
2. API 호출시 엔드포인트에 나의 local 주소가 선두에 자동으로 삽입되는 문제
//vite.config.ts 여기서 base의 문제 같다. 
![[스크린샷 2022-12-21 오후 5.40.21.png]]
[해결 출처](https://velog.io/@kdeun1/vue-cli-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EB%A5%BC-vite-3%EC%9C%BC%EB%A1%9C-%EB%A7%88%EC%9D%B4%EA%B7%B8%EB%A0%88%EC%9D%B4%EC%85%98%ED%95%B4%EB%B3%B4%EA%B8%B0)
-> proxy 설정을 통해서 가능할까
-> secure method 설정을 통해서 가능할 것 같다...[github issue](https://github.com/vitejs/vite/issues/564)


-> 3시간째 삽질중...
[[proxy(FN)]]

-> baseUrl와 뭔가 연관이 있는것같다. 
-> 지우고 했는데도 안된다>..?
-> 5시간째 삽질중
-> 데이터를 부를때 localhost가 앞에 붙어서 불러와져서 API endpoint가 붙지 않는 현상.
-> vite... 여기서 Proxy 서버를 사용하는데 잘 안된다. 
휴식후
-> 과거 프로젝트, 원티드 자료 찾아보기


-> https://ko.javascript.info/fetch-crossorigin
CORS 
1. trick
	-> form , script 
2. 안전한 요청
	1. 안전한 메소드 - get, post ,HEAD를 사용한 요청![[스크린샷 2022-12-22 오후 2.51.15.png]]
	2. 안전한 헤더 - 다음 목록에 속한 헤더
![[스크린샷 2022-12-22 오전 9.44.04.png]]

Q. api에 크로스 오리진이 있는지
Q. 2차 프로젝트에서 한것 가져올 수 있는 것 가져오기 
-> http 1.1 뺴기 

#### 해결
해당 페이지로 이동한 다음 요청을 보내면 될 것 같아서 a 태크 를 활용해서 라우터 이동을 해줘서 인가코드, 리다이렉트를 제공받았다....... 결국 fetch가 아니었다. 즉 카카오톡 로그인 요청 url에 fetch를 하고 있었다. 완전히 뻘짓 그러니 응답값이 없지. 

왜? 정리하기 


[[카카오톡 공식문공식문서 파헤치기]]

3. API 콜이 두번 진행되면서 에러 발생 
 ![[스크린샷 2022-12-22 오후 2.16.32.png]]![[스크린샷 2022-12-22 오후 2.51.15.png]]
두번 호출되면서 새로운 코드가 
1. strictMode 두번 렌더링 되는 현상? x





## 12/21
### 4. 빌드해서 베포한 페이지에선, https (동의화면 ) -> 리다이랙트 화면으로 안넘어감. 프록시 문제





## 12/22
### 5. a Tag로 페이지 이동
![[스크린샷 2022-12-22 오후 8.31.32.png]]

a 태그와 navigater and location의 차이를 찾아봐야겠다

#### 차이
a 태크는 새로고침을 하지만 LInk는 새로 고침을 하지 않는다.
새로고침이 되면 SPA의 state등 정보들은 다 날아간다... 그래서 다 날아가는거였다.

### group페이지에서 새로고침을 하면 home으로 가게 되는데 
안그랬으면 좋겠다... 그래서 react router-dom을 확인해서 보내는 방법을 간구해야겠다 
이 라이브러리를 사용하면 될 것 같다.
https://www.npmjs.com/package/react-beforeunload


### 토큰을 localStorage에서 관리하는게 맞는가?
localStorage에서 관리하면 **XSS 해킹 공격**을 통하여 해커의 악성스크립트에 노출이 되는 경우 매우 쉽게 토큰이 탈취 될 수 있습니다. 그냥 localStorage 에 접근하면 바로 토큰에 접근 할 수 있기 때문이죠.

첫번째 해결방안 
 이 **토큰을 쿠키에 넣는 것** 입니다. 쿠키를 쓰지 않으려고 토큰을 쓰는 줄 알았는데, 갑자기 이렇게 설명을 하니 헷갈릴 수도 있습니다. 쿠키를 사용한다고해서 세션을 관리하는것은 아니고, 그저 쿠키를 정보 전송수단으로 사용 할 뿐입니다. 이 과정에서, 서버측에서 응답을 하면서 쿠키를 설정 해 줄 때 `httpOnly` 값을 활성화를 해주면, 네트워크 통신 상에서만 해당 쿠키가 붙게 됩니다. 따라서, 브라우저상에서는, 자바스크립트로 토큰값에 접근하는것이 불가능해지죠.

만약에 모바일 어플리케이션도 개발을 하게 된다면, 서버측에서 JWT 를 헤더 값으로도 받을 수 있게 하여 쿠키 혹은 헤더 둘 중 존재하는것을 토큰으로 인식하여 사용하도록 구현을 하면 됩니다.

두번째 대안에 대한 단점은, **쿠키가 한정된 도메인에서만 사용이 된다**는 점 입니다. 이 부분은, 토큰이 필요해질 때 현재 쿠키에 있는 토큰을 사용하여 새 토큰을 문자열로 받아올 수 있게 하는 API를 구현하여 해결하면 됩니다.

또 다른 단점은, XSS의 위험에서 완벽히 해방되는 대신, **CSRF 공격의 위험성이 생긴다**는 점 입니다. CSRF은, 계정정보를 탈취하는것은 아니지만, 스크립트를 통하여 사이트의 외부에서 사이트의 API 를 사용하는것 처럼 모방하는 것 입니다. 혹은, 사이트 내부에서 스크립트가 실행되어 원하지 않는 작업이 수행되게 할 수도 있습니다.

->토큰을 httpOnly 속성이 활성화된 쿠키에 담아서 구현을 하도록 하겠습니다.

## 12/23
### 7. token에 expire을 확인하자 
### 8. 유저 스토리를 아예 바꾸자
### 9. 가끔 token이 undefined 뜨는 에러 해결하기 
![[스크린샷 2022-12-23 오후 8.44.40.png]]

```tsx
import { KAKAO_TOKEN_URL, LOGIN } from '../constants/config';

  

export const getRequest = async (code: string | null): Promise<string> => {

const requestUrl = `${KAKAO_TOKEN_URL}?grant_type=authorization_code&client_id=${

import.meta.env.VITE_CLIENT_KEY

}&redirect_uri=${LOGIN.REDIRECT_URI}&code=${code}`;

const requestHeaders = {

method: 'POST',

headers: {

'Content-type': 'application/x-www-form-urlencoded;charset=utf-8',

},

};

const response = await fetch(requestUrl, requestHeaders);

return response.json();

};
```
다른 것도 없는데 왜 두번을 찌르는거지? 한번은 성공하고 한번은 실패하는 문제
![[스크린샷 2022-12-23 오후 8.50.51.png]]
이렇게 콘솔이 나온다..
왜 두번 찔러지는거지? 

useEffect를 아예 지우고 밖에 꺼내놓았다
```tsx
useEffect(() => {

getToken();

}, [code]);

```

```tsx

getToken();


```

-> ![[스크린샷 2022-12-23 오후 8.54.28.png]]
잘되는데 여기서 문제 
어쩔때는 되고 어쩔땐 안되는 상황
![[스크린샷 2022-12-23 오후 8.56.18.png]]
useEffect를 지웠는데도 두번 호출이 되는 상황

뭐가 문제일까?

로컬 스토리지에 값이 있으면이라는 로직이 두번인 것 같다...
최상위에서랑 핸들러에서 두번 삽입 과연?

비동기 문제 같다...
처음 요청을 할떄는 뭐가 값이 없어서 안되고 두번째에서야 읽혀서 되는 느낌이다!!!!

아니었따

자세히 보니 첫번쨰 호출은 성공하지만 재호출 되는 바람에 에러가 떠서 불안전하게 토큰을 받는 것. 

-> 
![[스크린샷 2022-12-23 오후 10.00.22.png]]
힌트!! 라우터에서 2번 렌더링이 일어난다는 것 발견

상위에서 렌더가 일어나면 하위에도 다 영향!! 리액트 기본 특징 

![[스크린샷 2022-12-23 오후 10.01.14.png]]


## 12/24
### 10. state는 비동기 
어렵지 않은 에러였지만 기본적인 부분이라 다시 짚고 넘어가보자 이번 기회에 다시 깊이 이해하기 
[[state 비동기 동기]]



## 12/26
![[스크린샷 2022-12-26 오후 6.09.59.png]]
이  json을 만들려고 하면 react hook form을 써야하나? 